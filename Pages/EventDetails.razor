@page "/events/{Id:int}"
@using EventEase.Models
@using EventEase.Services
@inject IEventService EventService

<div class="container">
    @if (currentEvent != null)
    {
        <h3>Event Details</h3>
        <div class="row">
            <div class="col-md-8">
                <EventCard Event="currentEvent" />
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-md-6">
                <AttendeeRegistration EventId="Id" OnRegistrationComplete="HandleRegistrationComplete" />
            </div>
            <div class="col-md-12 mt-4">
                <AttendeeList EventId="Id" />
            </div>
        </div>

        <div class="mt-3">
            <a href="/events" class="btn btn-secondary">Back to Events</a>
        </div>
    }
    else
    {
        <p>Event not found.</p>
    }
</div>

@code {
    [Parameter]
    public int Id { get; set; }

    private Event? currentEvent;

    protected override async Task OnInitializedAsync()
    {
        currentEvent = await EventService.GetEventByIdAsync(Id);
    }

    private async Task HandleRegistrationComplete()
    {
        await Task.Delay(100); // Give time for the AttendanceService to update
        await InvokeAsync(StateHasChanged);
    }
}